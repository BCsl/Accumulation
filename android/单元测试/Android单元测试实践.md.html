<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>Android单元测试实践</title>
      <style>.markdown-preview:not([data-use-github-style]) { padding: 2em; font-size: 1.2em; color: rgb(56, 58, 66); overflow: auto; background-color: rgb(250, 250, 250); }
.markdown-preview:not([data-use-github-style]) > :first-child { margin-top: 0px; }
.markdown-preview:not([data-use-github-style]) h1, .markdown-preview:not([data-use-github-style]) h2, .markdown-preview:not([data-use-github-style]) h3, .markdown-preview:not([data-use-github-style]) h4, .markdown-preview:not([data-use-github-style]) h5, .markdown-preview:not([data-use-github-style]) h6 { line-height: 1.2; margin-top: 1.5em; margin-bottom: 0.5em; color: rgb(0, 0, 0); }
.markdown-preview:not([data-use-github-style]) h1 { font-size: 2.4em; font-weight: 300; }
.markdown-preview:not([data-use-github-style]) h2 { font-size: 1.8em; font-weight: 400; }
.markdown-preview:not([data-use-github-style]) h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview:not([data-use-github-style]) h4 { font-size: 1.2em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h6 { font-size: 1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) strong { color: rgb(0, 0, 0); }
.markdown-preview:not([data-use-github-style]) del { color: rgb(94, 97, 110); }
.markdown-preview:not([data-use-github-style]) a, .markdown-preview:not([data-use-github-style]) a code { color: rgb(82, 111, 255); }
.markdown-preview:not([data-use-github-style]) img { max-width: 100%; }
.markdown-preview:not([data-use-github-style]) > p { margin-top: 0px; margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) > ul, .markdown-preview:not([data-use-github-style]) > ol { margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) blockquote { margin: 1.5em 0px; font-size: inherit; color: rgb(94, 97, 110); border-color: rgb(209, 209, 210); border-width: 4px; }
.markdown-preview:not([data-use-github-style]) hr { margin: 3em 0px; border-top-width: 2px; border-top-style: dashed; border-top-color: rgb(209, 209, 210); background: none; }
.markdown-preview:not([data-use-github-style]) table { margin: 1.5em 0px; }
.markdown-preview:not([data-use-github-style]) th { color: rgb(0, 0, 0); }
.markdown-preview:not([data-use-github-style]) th, .markdown-preview:not([data-use-github-style]) td { padding: 0.66em 1em; border: 1px solid rgb(209, 209, 210); }
.markdown-preview:not([data-use-github-style]) code { color: rgb(0, 0, 0); background-color: rgb(234, 234, 235); }
.markdown-preview:not([data-use-github-style]) pre.editor-colors { margin: 1.5em 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(240, 240, 240); }
.markdown-preview:not([data-use-github-style]) kbd { color: rgb(0, 0, 0); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(209, 209, 210) rgb(209, 209, 210) rgb(193, 193, 194); background-color: rgb(234, 234, 235); }
.markdown-preview[data-use-github-style] { font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; line-height: 1.6; word-wrap: break-word; padding: 30px; font-size: 16px; color: rgb(51, 51, 51); overflow: scroll; background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview[data-use-github-style] h1, .markdown-preview[data-use-github-style] h2, .markdown-preview[data-use-github-style] h3, .markdown-preview[data-use-github-style] h4, .markdown-preview[data-use-github-style] h5, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview[data-use-github-style] h1 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview[data-use-github-style] h1 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] p, .markdown-preview[data-use-github-style] blockquote, .markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol, .markdown-preview[data-use-github-style] dl, .markdown-preview[data-use-github-style] table, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview[data-use-github-style] ul.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview[data-use-github-style] ul ul, .markdown-preview[data-use-github-style] ul ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview[data-use-github-style] table th, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] code, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview[data-use-github-style] code::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview[data-use-github-style] code::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: " "; }
.markdown-preview[data-use-github-style] code br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview[data-use-github-style] .highlight pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview[data-use-github-style] pre code, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview[data-use-github-style] pre code::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-style: solid; border-width: 1px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview[data-use-github-style] a { color: rgb(51, 122, 183); }
.markdown-preview[data-use-github-style] code { color: inherit; }
.markdown-preview[data-use-github-style] pre.editor-colors { padding: 0.8em 1em; margin-bottom: 1em; font-size: 0.85em; border-radius: 4px; overflow: auto; }
.scrollbars-visible-always .markdown-preview pre.editor-colors::shadow .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors::shadow .horizontal-scrollbar { visibility: hidden; }
.scrollbars-visible-always .markdown-preview pre.editor-colors:hover::shadow .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors:hover::shadow .horizontal-scrollbar { visibility: visible; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

.spell-check-misspelling .region {
  border-bottom: 2px dotted rgba(255, 51, 51, 0.75);
}

.markdown-themeable-pdf-page-break {
  border-top: 2px dotted #0098ff;
}
.markdown-themeable-pdf-page-break span {
  opacity: .35;
}

pre.editor-colors,
.host {
  background-color: #fafafa;
  color: #383a42;
}
pre.editor-colors .line.cursor-line,
.host .line.cursor-line {
  background-color: rgba(56, 58, 66, 0.04);
}
pre.editor-colors .invisible,
.host .invisible {
  color: #383a42;
}
pre.editor-colors .cursor,
.host .cursor {
  border-left: 2px solid #526fff;
}
pre.editor-colors .selection .region,
.host .selection .region {
  background-color: #ededed;
}
pre.editor-colors .bracket-matcher .region,
.host .bracket-matcher .region {
  border-bottom: 1px solid #526fff;
  box-sizing: border-box;
}
pre.editor-colors .invisible-character,
.host .invisible-character {
  color: rgba(56, 58, 66, 0.2);
}
pre.editor-colors .indent-guide,
.host .indent-guide {
  color: rgba(56, 58, 66, 0.2);
}
pre.editor-colors .wrap-guide,
.host .wrap-guide {
  background-color: rgba(56, 58, 66, 0.2);
}
pre.editor-colors .gutter .line-number,
.host .gutter .line-number {
  color: #9d9d9f;
  -webkit-font-smoothing: antialiased;
}
pre.editor-colors .gutter .line-number.cursor-line,
.host .gutter .line-number.cursor-line {
  color: #383a42;
  background-color: #f2f2f2;
}
pre.editor-colors .gutter .line-number.cursor-line-no-selection,
.host .gutter .line-number.cursor-line-no-selection {
  background-color: transparent;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #383a42;
}
pre.editor-colors .gutter:not(.git-diff-icon) .line-number.git-line-removed.git-line-removed::before,
.host .gutter:not(.git-diff-icon) .line-number.git-line-removed.git-line-removed::before {
  bottom: -3px;
}
pre.editor-colors .gutter:not(.git-diff-icon) .line-number.git-line-removed::after,
.host .gutter:not(.git-diff-icon) .line-number.git-line-removed::after {
  content: "";
  position: absolute;
  left: 0px;
  bottom: 0px;
  width: 25px;
  border-bottom: 1px dotted rgba(255, 20, 20, 0.5);
  pointer-events: none;
}
pre.editor-colors .gutter .line-number.folded,
.host .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
.host .gutter .line-number:after,
pre.editor-colors .fold-marker:after,
.host .fold-marker:after {
  color: #383a42;
}
.comment {
  color: #a0a1a7;
  font-style: italic;
}
.comment .markup.link {
  color: #a0a1a7;
}
.entity.name.type {
  color: #c18401;
}
.entity.other.inherited-class {
  color: #50a14f;
}
.keyword {
  color: #a626a4;
}
.keyword.control {
  color: #a626a4;
}
.keyword.operator {
  color: #383a42;
}
.keyword.other.special-method {
  color: #4078f2;
}
.keyword.other.unit {
  color: #986801;
}
.storage {
  color: #a626a4;
}
.storage.type.annotation,
.storage.type.primitive {
  color: #a626a4;
}
.storage.modifier.package,
.storage.modifier.import {
  color: #383a42;
}
.constant {
  color: #986801;
}
.constant.variable {
  color: #986801;
}
.constant.character.escape {
  color: #0184bc;
}
.constant.numeric {
  color: #986801;
}
.constant.other.color {
  color: #0184bc;
}
.constant.other.symbol {
  color: #0184bc;
}
.variable {
  color: #e45649;
}
.variable.interpolation {
  color: #ca1243;
}
.variable.parameter {
  color: #383a42;
}
.string {
  color: #50a14f;
}
.string.regexp {
  color: #0184bc;
}
.string.regexp .source.ruby.embedded {
  color: #c18401;
}
.string.other.link {
  color: #e45649;
}
.punctuation.definition.comment {
  color: #a0a1a7;
}
.punctuation.definition.method-parameters,
.punctuation.definition.function-parameters,
.punctuation.definition.parameters,
.punctuation.definition.separator,
.punctuation.definition.seperator,
.punctuation.definition.array {
  color: #383a42;
}
.punctuation.definition.heading,
.punctuation.definition.identity {
  color: #4078f2;
}
.punctuation.definition.bold {
  color: #c18401;
  font-weight: bold;
}
.punctuation.definition.italic {
  color: #a626a4;
  font-style: italic;
}
.punctuation.section.embedded {
  color: #ca1243;
}
.punctuation.section.method,
.punctuation.section.class,
.punctuation.section.inner-class {
  color: #383a42;
}
.support.class {
  color: #c18401;
}
.support.type {
  color: #0184bc;
}
.support.function {
  color: #0184bc;
}
.support.function.any-method {
  color: #4078f2;
}
.entity.name.function {
  color: #4078f2;
}
.entity.name.class,
.entity.name.type.class {
  color: #c18401;
}
.entity.name.section {
  color: #4078f2;
}
.entity.name.tag {
  color: #e45649;
}
.entity.other.attribute-name {
  color: #986801;
}
.entity.other.attribute-name.id {
  color: #4078f2;
}
.meta.class {
  color: #c18401;
}
.meta.class.body {
  color: #383a42;
}
.meta.method-call,
.meta.method {
  color: #383a42;
}
.meta.definition.variable {
  color: #e45649;
}
.meta.link {
  color: #986801;
}
.meta.require {
  color: #4078f2;
}
.meta.selector {
  color: #a626a4;
}
.meta.separator {
  background-color: #373b41;
  color: #383a42;
}
.meta.tag {
  color: #383a42;
}
.underline {
  text-decoration: underline;
}
.none {
  color: #383a42;
}
.invalid.deprecated {
  color: #000000 !important;
  background-color: #f2a60d !important;
}
.invalid.illegal {
  color: #ffffff !important;
  background-color: #ff1414 !important;
}
.markup.bold {
  color: #986801;
  font-weight: bold;
}
.markup.changed {
  color: #a626a4;
}
.markup.deleted {
  color: #e45649;
}
.markup.italic {
  color: #a626a4;
  font-style: italic;
}
.markup.heading {
  color: #e45649;
}
.markup.heading .punctuation.definition.heading {
  color: #4078f2;
}
.markup.link {
  color: #a626a4;
}
.markup.inserted {
  color: #50a14f;
}
.markup.quote {
  color: #986801;
}
.markup.raw {
  color: #50a14f;
}
.source.cs .keyword.operator {
  color: #a626a4;
}
.source.css .property-name,
.source.css .property-value {
  color: #696c77;
}
.source.css .property-name.support,
.source.css .property-value.support {
  color: #383a42;
}
.source.gfm .markup {
  -webkit-font-smoothing: auto;
}
.source.gfm .link .entity {
  color: #4078f2;
}
.source.ini .keyword.other.definition.ini {
  color: #e45649;
}
.source.java .storage.modifier.import {
  color: #c18401;
}
.source.java .storage.type {
  color: #c18401;
}
.source.java-properties .meta.key-pair {
  color: #e45649;
}
.source.java-properties .meta.key-pair > .punctuation {
  color: #383a42;
}
.source.js .keyword.operator {
  color: #0184bc;
}
.source.js .keyword.operator.delete,
.source.js .keyword.operator.in,
.source.js .keyword.operator.of,
.source.js .keyword.operator.instanceof,
.source.js .keyword.operator.new,
.source.js .keyword.operator.typeof,
.source.js .keyword.operator.void {
  color: #a626a4;
}
.source.json .meta.structure.dictionary.json > .string.quoted.json {
  color: #e45649;
}
.source.json .meta.structure.dictionary.json > .string.quoted.json > .punctuation.string {
  color: #e45649;
}
.source.json .meta.structure.dictionary.json > .value.json > .string.quoted.json,
.source.json .meta.structure.array.json > .value.json > .string.quoted.json,
.source.json .meta.structure.dictionary.json > .value.json > .string.quoted.json > .punctuation,
.source.json .meta.structure.array.json > .value.json > .string.quoted.json > .punctuation {
  color: #50a14f;
}
.source.json .meta.structure.dictionary.json > .constant.language.json,
.source.json .meta.structure.array.json > .constant.language.json {
  color: #0184bc;
}
.source.ruby .constant.other.symbol > .punctuation {
  color: inherit;
}
.source.python .keyword.operator.logical.python {
  color: #a626a4;
}
.source.python .variable.parameter {
  color: #986801;
}
</style>
  </head>
  <body class='markdown-preview' data-use-github-style><h1 id="android-">Android 单元测试实践</h1>
<h2 id="-">什么是单元测试</h2>
<p>在计算机编程中，单元测试（Unit Testing）又称为模块测试, 是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。但是什么叫&quot;程序单元&quot;呢？是一个模块、还是一个类、还是一个方法（函数）呢？不同的人、不同的语言，都有不同的理解。一般的定义，尤其是是在OOP领域，是一个类的一个方法。在此，我们也这样理解：单元测试，是为了测试某一个类的某一个方法能否正常工作，而写的测试代码。</p>
<p>单元测试的三个步骤：</p>
<ul>
<li>setup：即新建出待测试的类、设置一些前提条件等</li>
<li>执行动作：即调用被测类的被测方法，并获取返回结果</li>
<li>验证结果：验证获取的结果跟预期的结果是一样的</li>
</ul>
<h2 id="-https-developer-android-com-studio-test-index-html-"><a href="https://developer.android.com/studio/test/index.html">单元测试不是集成测试</a></h2>
<p>这里需要强调一个观念，那就是单元测试只是测试一个方法单元，它不是测试一整个流程。举个例子来说，一个Login页面，上面有两个输入框和一个button。两个输入框分别用于输入用户名和密码。点击button以后，有一个UserManager会去执行performlogin操作，然后将结果返回，更新页面。那么我们给这个东西做单元测试的时候，不是测这一整个login流程。这种整个流程的测试：给两个输入框设置正确的用户名和密码，点击login button，最后页面得到更新。叫做集成测试，而不是单元测试。当然，集成测试也是有他的必要性的，然而这不是每个程序员应该花多少精力所在的地方。为什么是这样呢？因为集成测试设置起来很麻烦，运行起来很慢，在保证代码质量、改善代码设计方面更起不到任何作用，因此它的重要程度并不是那么高</p>
<h2 id="-">为什么要做单元测试</h2>
<ul>
<li><p>也许是因为换了工作，也许是因为职位调动，或其他原因，需要接手新的项目，当拿到一个新项目的时候，会有一种诚惶诚恐的感觉，因为一时间比较难理清楚整个app的结构是怎么划分的，各部分各模块之间又是什么样的关系。会怕改了某一个地方，结果其他一个莫名其妙的地方的受到了影响，然后导致了一个bug。所以，那种时候就会希望，如果我改了某个地方，能有个东西告诉我，这个改动影响到哪些地方，这样改是不是有问题的，会不会导致bug。虽然我可以把app启动起来，看看是不是能正常工作，然而一种case能工作，并不代表所有影响到的case都能工作，例如，一个密码设置功能，可能有不同的入口，首次启动的密码设置，设置界面的修改密码、设置界面的重置密码或者还有只有会员才有的增强密码设置，这样我就可能需要安装APP，进入不同的入口进行操作来验证这段代码是否正确，这也是一个很痛苦很费时间的过程，而且很多的外部条件也很难满足，比如说需要什么样的网络条件，需要用户是会员等等。尤其是在不知道有哪些地方用到了的情况下，我更加难以去遍历所有用到的地方，一个一个去验证这个改动有没有问题。在这种情况下，单元测试是才是最好的工具。首先，单元测试只是针对一个代码单元写的测试，保证一个代码单元的正确性总比保证整个app的正确性容易吧？遍历一个方法的所有参数和输出情况总比遍历一个app的所有用户场景容易吧？跑一次单元测试总比运行一次app快吧？</p>
</li>
<li><p>在不写单元测试的情况下，我们的开发流程可能是这样的，要把整个功能都做完整，从model到controller(或Presenter、ViewModel）到view到util等等，一整套流程做下来，到最后才可能运行起来看看是不是对的，有的时候哪怕所有代码都写完了，也不一定能验证是不是对的，比如说后台还没有ready等等。总之，在没有单元测试的情况下，我们需要等到最后一刻才能手动验证代码是不是对的，然后发现原来这里错了一点，那里少了一点，然后一遍一遍的把app运行起来，改一点运行一遍。。。当开始写单元测试之后，可以在写完一部分功能独立的代码后，就能立刻看到他们是不是正确的。如果不是的话，我可以立刻就改正，而不用等到所有代码都写完整</p>
</li>
<li><p>不熟悉你的代码的人人看你的代码的时候，如果有单元测试代码，对别人理解你的代码会有一定的促进作用，因为单元测试代码里面一般会包含了你当时设计这部分模块时的思路</p>
</li>
</ul>
<h2 id="local-unit-tests">Local Unit Tests</h2>
<p>Local Unit Tests运行在本地JVM，不需要安装APP，所以运行时间很快。也因此不能依赖Android的API，所以大多数时候需要用Mock的形式来做替换（后面的Mockito章节会提到）。 <img src="/home/chensuilun/&#x6587;&#x6863;/Accumulation/android/&#x5355;&#x5143;&#x6D4B;&#x8BD5;/img/LocalUnitTests.png" alt="LocalUnitTests"></p>
<h3 id="-https-developer-android-com-training-testing-start-index-html-"><a href="https://developer.android.com/training/testing/start/index.html">配置</a></h3>
<ul>
<li>测试代码目录：(src/test/java)</li>
<li>一般使用到的测试框架<ul>
<li>JUnit4</li>
<li>Mockito</li>
</ul>
</li>
</ul>
<h3 id="-">使用</h3>
<h4 id="junit4">JUnit4</h4>
<p>这是Java界用的最广泛，也是最基础的一个框架，其他的很多框架，包括我们后面会看到的Mockito，都是基于或兼容JUnit4的。 使用比较简单，最多的是其<code>Assert</code>类提供的<code>assertXXX</code>方法。</p>
<p>假设这样的一个类需要测试</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>Calculator</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>add</span></span><span>(</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;</span><span class="variable parameter java"><span>one</span></span><span>,&nbsp;</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;</span><span class="variable parameter java"><span>another</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;one&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;another</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>multiply</span></span><span>(</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;</span><span class="variable parameter java"><span>one</span></span><span>,&nbsp;</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;</span><span class="variable parameter java"><span>another</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;one&nbsp;</span><span class="keyword operator arithmetic java"><span>*</span></span><span>&nbsp;another</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div></pre>
<p>如果不使用单元测试框架，我们可能需要这样来验证这段代码的正确性：</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>CalculatorTest</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>main</span></span><span>(</span><span class="storage type object array java"><span>String</span></span><span>[]&nbsp;</span><span class="variable parameter java"><span>args</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Calculator</span></span><span>&nbsp;calculator&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>Calculator</span></span><span>(</span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;sum&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;calculator</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>add</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>1</span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="constant numeric java"><span>2</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>(</span><span>sum&nbsp;</span><span class="keyword operator comparison java"><span>==</span></span><span>&nbsp;</span><span class="constant numeric java"><span>3</span></span><span>)</span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>System</span></span><span class="keyword operator dereference java"><span>.</span></span><span>out</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>println</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>add()&nbsp;works!</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end java"><span>}</span></span><span>&nbsp;</span><span class="keyword control java"><span>else</span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>System</span></span><span class="keyword operator dereference java"><span>.</span></span><span>out</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>println</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>add()&nbsp;does&nbsp;not&nbsp;works!</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end java"><span>}</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;product&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;calculator</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>multiply</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>2</span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="constant numeric java"><span>4</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span>(</span><span>product&nbsp;</span><span class="keyword operator comparison java"><span>==</span></span><span>&nbsp;</span><span class="constant numeric java"><span>8</span></span><span>)</span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>System</span></span><span class="keyword operator dereference java"><span>.</span></span><span>out</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>println</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>multiply()&nbsp;works!</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end java"><span>}</span></span><span>&nbsp;</span><span class="keyword control java"><span>else</span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>System</span></span><span class="keyword operator dereference java"><span>.</span></span><span>out</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>println</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>multiply()&nbsp;does&nbsp;not&nbsp;works!</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end java"><span>}</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>然后我们再通过某种方式，比如命令行或IDE，运行这个<code>CalculatorTest</code>的<code>main</code>方法，在看着terminal的输出，才知道测试是通过还是失败。想一下，如果我们有很多的类，每个类都有很多方法，那么就要写一堆这样的代码，每个类对于一个含有main方法的test类，同时main方法里面会有一堆代码。这样既写起来痛苦，跑起来更痛苦，比如说，你怎么样一次性跑所有的测试类呢？所以，一个测试框架为我们做的最基本的事情，就是允许我们按照某种更简单的方式写测试代码，把每一个测试单元写在一个测试方法里面，然后它会自动找出所有的测试方法，并且根据你的需要，运行所有的测试方法，或者是运行单个测试方法，或者是运行部分测试方法等等。 对于上面的例子，如果使用Junit的话，我们可以按照如下的方式写测试代码：</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>CalculatorTest</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Calculator</span></span><span>&nbsp;mCalculator</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Before</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>setup</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mCalculator&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>Calculator</span></span><span>(</span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>testAdd</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="meta throwables java"><span class="storage modifier java"><span>throws</span></span><span>&nbsp;</span><span class="storage type java"><span>Exception</span></span><span>&nbsp;</span></span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;sum&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;calculator</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>add</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>1</span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="constant numeric java"><span>2</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertEquals</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>3</span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;sum</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>testMultiply</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="meta throwables java"><span class="storage modifier java"><span>throws</span></span><span>&nbsp;</span><span class="storage type java"><span>Exception</span></span><span>&nbsp;</span></span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;product&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;calculator</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>multiply</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>2</span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="constant numeric java"><span>4</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertEquals</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>8</span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;product</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>上面的<code>@Before</code>修饰的方法，会在测试开始前调用，这里是新建了一个<code>Calculator</code>对象，所以之后的一些测试单元都可以直接使用这个实例，<code>@Test</code>修饰的方法，是用来需要测试的单元，例如<code>testAdd</code>方法是用来测试<code>Calculator</code>类的加法操作，测试单元内使用<code>Assert</code>类提供的<code>assertXXX</code>方法来验证结果。如果还有其他的测试方法，则以此类推。 另外还有一些可能需要用到的修饰符，如<code>@After</code>，<code>@BeforeClass</code>，<code>@AfterClass</code>等。</p>
<h4 id="mockito">Mockito</h4>
<p>Mockito的两个重要的功能是，验证Mock对象的方法的调用和可以指定mock对象的某些方法的行为。（对于不懂Mock概念的同学来说，第一次看到的确很可能很难理解）</p>
<h5 id="-mockito-">为什么要使用Mockito？</h5>
<p>这是项目中的一个例子：</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></div><div class="line"><span class="source java"><span class="comment block java"><span>&nbsp;*&nbsp;@param&nbsp;&lt;T&gt;&nbsp;用于过滤的实体类型</span></span></span></div><div class="line"><span class="source java"><span class="comment block java"><span>&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>interface</span></span><span>&nbsp;</span><span class="entity name type class java"><span>BaseItemFilter</span></span></span><span>&lt;T&gt;&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;item</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;true：不过滤;false：需要过滤</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="meta method return-type java"><span class="storage type primitive array java"><span>boolean</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>accept</span></span><span>(</span><span class="storage type java"><span>T</span></span><span>&nbsp;</span><span class="variable parameter java"><span>item</span></span><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p><code>BaseItemFilter</code>是用来判断某种指定类型的实体是否需要过滤的，类似java中的<code>FileFilter</code>，目的是为了用了过滤不符合要求的实体。</p>
<p>以下是我们的关键服务过滤器的实现：</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>EssentialProcessFilter</span></span></span><span>&nbsp;</span><span class="meta definition class implemented interfaces java"><span class="storage modifier implements java"><span>implements</span></span><span>&nbsp;</span><span class="entity other inherited-class java"><span>BaseItemFilter&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>&nbsp;</span></span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;系统关键进程及用户主要的进程</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="meta definition variable java"><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage type generic java"><span>HashSet&lt;</span><span class="storage type java"><span>String</span></span><span>&gt;</span></span><span>&nbsp;</span><span class="meta definition variable name java"><span>sCoreList</span></span><span>&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type generic java"><span>HashSet&lt;</span><span class="storage type java"><span>String</span></span><span>&gt;</span></span><span>(</span><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;加载系统核心进程列表</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>loadCoreList</span></span><span>(</span><span class="storage type java"><span>Context</span></span><span>&nbsp;</span><span class="variable parameter java"><span>context</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span>(</span><span>sCoreList</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isEmpty</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>)</span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>Resources</span></span><span>&nbsp;r&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;context</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getResources</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type object array java"><span>String</span></span><span>[]&nbsp;corePackages&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;r</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getStringArray</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>R</span></span><span class="keyword operator dereference java"><span>.</span></span><span>array</span><span class="keyword operator dereference java"><span>.</span></span><span>default_core_list</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Collections</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>addAll</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>sCoreList</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;corePackages</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end java"><span>}</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>boolean</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>accept</span></span><span>(</span><span class="storage type java"><span>RunningAppBean</span></span><span>&nbsp;</span><span class="variable parameter java"><span>appModle</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;appModle&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span>&nbsp;</span><span class="keyword operator logical java"><span>&amp;&amp;</span></span><span>&nbsp;</span><span class="keyword operator logical java"><span>!</span></span><span>(</span><span class="meta method-call java"><span class="meta method java"><span>isEssentialProcess</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>appModle</span><span class="keyword operator dereference java"><span>.</span></span><span>mPackageName</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="keyword operator logical java"><span>||</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>isEssentialProcessMock</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>appModle</span><span class="keyword operator dereference java"><span>.</span></span><span>mPackageName</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;appModle</span><span class="keyword operator dereference java"><span>.</span></span><span>mIsSysApp</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;判断进程是否属于重要进程</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;process</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>boolean</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>isEssentialProcess</span></span><span>(</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>process</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;sCoreList</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>contains</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>process</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;系统关键进程关键词模糊匹配</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;packageName</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;isSystemApp</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>boolean</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>isEssentialProcessMock</span></span><span>(</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>packageName</span></span><span>,&nbsp;</span><span class="storage type primitive array java"><span>boolean</span></span><span>&nbsp;</span><span class="variable parameter java"><span>isSystemApp</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;省略</span><span class="keyword operator dereference java"><span>.</span><span>.</span><span>.</span></span><span>额外的一些判断</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>可以看到，这里的关键服务的判断的判断规则可以分两部分，一个是从<code>String.xml</code>中预设的一段<code>Arrays</code>数组查找是否右符合的，这个需要在初始化或某个时机预先调用<code>EssentialProcessFilter#loadCoreList（Context context）</code>方法来加载，另外的一个判断是在<code>EssentialProcessFilter#isEssentialProcessMock</code>方法中定义，这个类中<code>accept</code>方法，定义了只要符合其中一种规则，那么我们就需要把它过滤。</p>
<p>这个时候我们来写单元测试，你一开始就会发现你没有办法新建一个<code>Context</code>对象来读取<code>String.xml</code>，即使你想尽任何方法新建一个<code>ContextImpl</code>实例，最后你还是会出错的，主要原因再在于Gradle运行<strong>Local Unit Test</strong> 所使用的<code>android.jar</code>里面所有API都是空实现，并抛出异常的。 现在想想，我们实际上并不需要真的读取<code>String.xml</code>，我们需要验证的是记录在我们的关键列表集合是否生效，既然这样，我们前面说过了，Mockito的两个重要的功能是，验证Mock对象的方法的调用和可以指定mock对象的某些方法的行为。我们是否可以Mock一个<code>Context</code>对象并且指定它读取<code>String.xml</code>的行为？答案是可以的，如下就是使用Mockito的一段测试代码</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>TestListFilter2</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Mock</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Context</span></span><span>&nbsp;mContext</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Mock</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Resources</span></span><span>&nbsp;mResources</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Before</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>setup</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>MockitoAnnotations</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>initMocks</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>when</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mContext</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getResources</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>thenReturn</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mResources</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>when</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mResources</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getStringArray</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>R</span></span><span class="keyword operator dereference java"><span>.</span></span><span>array</span><span class="keyword operator dereference java"><span>.</span></span><span>default_core_list</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>thenReturn</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>getEssentialProcessArray</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>模拟加载XML资源</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>EssentialProcessFilter</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>loadCoreList</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mContext</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;测试关键服务的过滤器</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>testEssentialFilter</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>EssentialProcessFilter</span></span><span>&nbsp;processFilter&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>EssentialProcessFilter</span></span><span>(</span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type generic java"><span>ListFilter&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>&nbsp;listFilter&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>spy</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ListFilter</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listFilter</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>addFilter</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>processFilter</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type generic java"><span>List&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>&nbsp;list&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type generic java"><span>ArrayList&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>(</span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>addAll</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>getEssentialAppBean</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>addAll</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>getNormalRunningApp</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type generic java"><span>List&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>&nbsp;result&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>mock</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ArrayList</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>for</span></span><span>&nbsp;</span><span>(</span><span class="storage type java"><span>RunningAppBean</span></span><span>&nbsp;runningAppBean&nbsp;</span><span class="keyword control ternary java"><span>:</span></span><span>&nbsp;list</span><span>)</span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>if</span></span><span>&nbsp;</span><span>(</span><span>listFilter</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>accept</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>runningAppBean</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>)</span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>add</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>runningAppBean</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end java"><span>}</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end java"><span>}</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>verify</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>listFilter</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>times</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>list</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>size</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>accept</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>any</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>RunningAppBean</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>verify</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>result</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>times</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>getNormalRunningApp</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>size</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>add</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>any</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>RunningAppBean</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;关键服务应用包名</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type object array java"><span>String</span></span><span>[]&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>getEssentialProcessArray</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>String</span></span><span>[</span><span>]</span><span class="punctuation section block begin java"><span>{</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>android.process.acore</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>,&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>android.process.media</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>,&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>android.tts</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>,&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>android.uid.phone</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>,&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>android.uid.shared</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>,&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>android.uid.system</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation section block end java"><span>}</span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;</span></span><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>上面的代码，我们使用<code>@Mock</code>来Mock了Context和Resource对象，这需要我们在<code>setup</code>的时候使用<code>MockitoAnnotations.initMocks(this)</code>方法来使得这些注解生效，如果再不使用<code>@Mock</code>注解的时候，我们还可以使用<code>Mockito.mock</code>方法来Mock对象。这里我们指定了<code>Context</code>对象在调用<code>getResources</code>方法的时候返回一个同样是Mock的<code>Resources</code>对象，这里的<code>Resources</code>对象，指定了在调用<code>getStringArray(R.array.default_core_list)</code>方法的时候返回的字符串数组的数据是通过我们的<code>getEssentialProcessArray</code>方法获得的，而不是真的是加载<code>String.xml</code>资源。最后调用<code>EssentialProcessFilter.loadCoreList(mContext)</code>方法使得<code>EssentialProcessFilter</code>内记录的关键服务集合的数据源就是我们指定的。目前，我们使用的就是改变Mock对象的行为的功能。</p>
<p>在测试单元<code>testEssentialFilter</code>方法中，使用<code>Mockito.spy(ListFilter.class)</code>来Mock一个<code>ListFilter</code>对象（这是一个<code>BaseItemFilter</code>的实现，里面记录了<code>BaseItemFilter</code>的集合，用了记录一系列的过滤规则），这里使用<code>spy</code>方法Mock出来的对象除非指定它的行为，否者调用这个对象的默认实现，而使用<code>mock</code>方法Mock出来的对象，如果不指定对象的行为的话，所有非void方法都将返回默认值：int、long类型方法将返回0，boolean方法将返回false，对象方法将返回null等等，我们也同样可以使用<code>@spy</code>注解来Mock对象。这里的<code>listFilter</code>对象使用<code>spy</code>是为了使用默认的行为，确保<code>accept</code>方法的逻辑正确执行，而<code>result</code>对象使用<code>mock</code>方式来Mock，是因为我们不需要真的把过滤后的数据添加到集合中，而只需要验证这个Mock对象的<code>add</code>方法调用的多少次即可。</p>
<p>最后就是对Mock对象的行为的验证，分别验证了<code>listFilter#accept</code>方法和<code>result#add</code>方法的执行次数，其中<code>Mockito#any</code>系列方法用来指定无论传入任何参数值。</p>
<h5 id="-">依赖注入，写出更容易测试的代码</h5>
<p>这里举一个新的例子，在使用MVP模式开发一个登录页</p>
<p>这是我们的<code>LoginPresenter</code>，<code>Presenter</code>的职责是作为<code>View</code>和<code>Model</code>之间的桥梁，<code>UserManager</code>就是这里的<code>Model</code>层，它用来处理用户登录的业务逻辑</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>LoginPresenter</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>LoginView</span></span><span>&nbsp;mLoginView</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta definition variable java"><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage type java"><span>UserManager</span></span><span>&nbsp;</span><span class="meta definition variable name java"><span>mUserManager</span></span><span>&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>UserManager</span></span><span>(</span><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method identifier java"><span class="entity name function java"><span>LoginPresenter</span></span><span>(</span><span class="storage type java"><span>LoginView</span></span><span>&nbsp;</span><span class="variable parameter java"><span>loginView</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mLoginView&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;loginView</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>login</span></span><span>(</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>username</span></span><span>,&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>password</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>....</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mLoginView</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>showLoginHint</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mUserManager</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>performLogin</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>username</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;password</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>...</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div></pre>
<p>这段代码存在了一些问题</p>
<ul>
<li>如果现在要改变<code>UserManager</code>生成方式，如需要用<code>new UserManager(String config)</code>初始化，需要修改<code>LoginPresenter</code>代码</li>
<li>如果想测试不同<code>UserManager</code>对象对<code>LoginPresenter</code>的影响很困难，因为<code>UserManager</code>的初始化被写死在了<code>LoginPresenter</code>的构造函数中（现在的Mockito可以使用<code>@InjectMocks</code>来很大程度缓解这个问题）</li>
</ul>
<p>为了把依赖解耦，我们一般可以作如下改变</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>LoginPresenter</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>LoginView</span></span><span>&nbsp;mLoginView</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>UserManager</span></span><span>&nbsp;mUserManager</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>将UserManager作为构造方法参数传进来</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method identifier java"><span class="entity name function java"><span>LoginPresenter</span></span><span>(</span><span class="storage type java"><span>LoginView</span></span><span>&nbsp;</span><span class="variable parameter java"><span>loginView</span></span><span>，</span><span class="storage type java"><span>UserManager</span></span><span>&nbsp;</span><span class="variable parameter java"><span>userManager</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="keyword operator dereference java"><span>.</span></span><span>mLoginView&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;loginView</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="keyword operator dereference java"><span>.</span></span><span>mUserManager&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;userManager</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>login</span></span><span>(</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>username</span></span><span>,&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>password</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>...&nbsp;some&nbsp;other&nbsp;code</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mUserManager</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>performLogin</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>username</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;password</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>这就是一种常见的依赖注入方式，这种方式的好处是，依赖关系非常明显。你必须在创建这个类的时候，就提供必要的dependency。这从某种程度上来说，也是在说明这个类所完成的功能。实现依赖注入很简单，比较有名的Dagger、Dragger2这些框架可以让这种实现变得更加简单，简洁，优雅，有兴趣可以自行了解。 作出这种修改之后，我们就可以很容易的Mock出<code>UserManager</code>对象来对<code>LoginPresenter</code>做单元测试</p>
<h5 id="-">对异步任务进行测试</h5>
<p>很多时候，我们耗时的业务逻辑都是再异步线程中处理的，这样就会对我们的测试造成了一些困难，因为很可能我们的异步任务执行完之前，我们的Test单元已经执行完了，为了能够顺利验证，其中一个思路是，首先需要一个回调接口来告诉我们处理完成，之后再我们知道回调后，继续执行测试代码，这里的一个简单实现就是使用<code>CountDownLatch</code>，也可以使用<code>wait</code>和<code>notifyAll</code>，下面以<code>CountDownLatch</code>为例子</p>
<p>这里是我们的回调接口</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>interface</span></span><span>&nbsp;</span><span class="entity name type class java"><span>ScanListener</span></span></span><span>&lt;T&gt;&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;t&nbsp;扫描结果</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>onScannedCompleted</span></span><span>(</span><span class="storage type java"><span>T</span></span><span>&nbsp;</span><span class="variable parameter java"><span>t</span></span><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>测试代码如下：</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>TestRunningAppScanner</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta definition variable java"><span class="storage type java"><span>CountDownLatch</span></span><span>&nbsp;</span><span class="meta definition variable name java"><span>mSignal</span></span><span>&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>RunningAppScanner</span></span><span>&nbsp;mRunningAppScanner</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Mock</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>BaseScanner</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="storage type generic java"><span>ScanListener&lt;</span><span class="storage type generic java"><span>List&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>&gt;</span></span><span>&nbsp;mRunningAppBeanScanListener</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Captor</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type generic java"><span>ArgumentCaptor&lt;</span><span class="storage type generic java"><span>List&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>&gt;</span></span><span>&nbsp;mListArgumentCaptor</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Before</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>setUp</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSignal&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>CountDownLatch</span></span><span>(</span><span class="constant numeric java"><span>1</span></span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>MockitoAnnotations</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>initMocks</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mRunningAppScanner&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>spy</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>RunningAppScanner</span></span><span>(</span><span class="storage type java"><span>InstrumentationRegistry</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getTargetContext</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>)</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@After</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>tearDown</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSignal</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>countDown</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>testRunningApp</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="meta throwables java"><span class="storage modifier java"><span>throws</span></span><span>&nbsp;</span><span class="storage type java"><span>InterruptedException</span></span><span>&nbsp;</span></span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertFalse</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isRunning</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>doAnswer</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>Answer</span></span><span>(</span><span>)</span><span>&nbsp;</span><span class="meta inner-class java"><span class="punctuation section inner-class begin java"><span>{</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type java"><span>Object</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>answer</span></span><span>(</span><span class="storage type java"><span>InvocationOnMock</span></span><span>&nbsp;</span><span class="variable parameter java"><span>invocation</span></span><span>)</span></span><span>&nbsp;</span><span class="meta throwables java"><span class="storage modifier java"><span>throws</span></span><span>&nbsp;</span><span class="storage type java"><span>Throwable</span></span><span>&nbsp;</span></span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSignal</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>countDown</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;invocation</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getArguments</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section inner-class end java"><span>}</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>when</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppBeanScanListener</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onScannedCompleted</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>(</span><span class="storage type generic java"><span>List&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>)</span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>any</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>setScanListener</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppBeanScanListener</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>startScanning</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertTrue</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isRunning</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSignal</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>await</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertFalse</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isRunning</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>verify</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppBeanScanListener</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>times</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>1</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onScannedCompleted</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mListArgumentCaptor</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>capture</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>必定最少有1个进程再运行</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertTrue</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mListArgumentCaptor</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getValue</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>size</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="keyword operator comparison java"><span>&gt;</span></span><span>&nbsp;</span><span class="constant numeric java"><span>0</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;</span></span><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>上面代码中Mock了一个<code>ScanListener</code>类型的回调接口，并在<code>testRunningApp</code>方法中，指定了它<code>onScannedCompleted</code>方法的行为，<code>RunningAppScanner#startScanning</code>方法是用来启动异步逻辑的，在开始异步逻辑之前设置了回调接口，在开始异步逻辑后，就使用了<code>mSignal.await()</code>方法来阻塞当前线程，直到<code>onScannedCompleted</code>方法的执行，会调用到在setup的时候新建的<code>CountDownLatch</code>对象的<code>countDown()</code>，表明异步任务的完成，以继续执行下面的测试代码</p>
<p>上面的测试代码实际上是属于<code>Instrumented Tests</code>，它的异步逻辑是去扫描当前设备运行的进程，需要运行再Android设备上，它的异步逻辑是实际运行的而且会扫描出真实结果。但有些时候，我们只是想<strong>验证状态和交互结果</strong>，而不需要它真的执行异步逻辑，我们可以使用其他的方式来进行测试，我们以一个登录流程为例子</p>
<p>这是登录流程的时序图</p>
<p><img src="/home/chensuilun/&#x6587;&#x6863;/Accumulation/android/&#x5355;&#x5143;&#x6D4B;&#x8BD5;/img/Login Sequence.png" alt="Login Sequence"></p>
<p>回调的定义</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>interface</span></span><span>&nbsp;</span><span class="entity name type class java"><span>LoginCallback</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>onSuccess</span></span><span>(</span><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>onFail</span></span><span>(</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;</span><span class="variable parameter java"><span>code</span></span><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>这是<code>LoginPresenter</code></p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>LoginPresenter</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>LoginView</span></span><span>&nbsp;mLoginView</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier java"><span>private</span></span><span>&nbsp;</span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>UserManager</span></span><span>&nbsp;mUserManager</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>将UserManager作为构造方法参数传进来</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method identifier java"><span class="entity name function java"><span>LoginPresenter</span></span><span>(</span><span class="storage type java"><span>LoginView</span></span><span>&nbsp;</span><span class="variable parameter java"><span>loginView</span></span><span>,&nbsp;</span><span class="storage type java"><span>UserManager</span></span><span>&nbsp;</span><span class="variable parameter java"><span>userManager</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="keyword operator dereference java"><span>.</span></span><span>mLoginView&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;loginView</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language this java"><span>this</span></span><span class="keyword operator dereference java"><span>.</span></span><span>mUserManager&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;userManager</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>login</span></span><span>(</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>username</span></span><span>,&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>password</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mLoginView</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>showLoginHint</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mUserManager</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>performLogin</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>username</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;password</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>UserManager</span></span><span>.</span><span class="storage type java"><span>LoginCallback</span></span><span>(</span><span>)</span><span>&nbsp;</span><span class="meta inner-class java"><span class="punctuation section inner-class begin java"><span>{</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>onSuccess</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mLoginView</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>showSuccess</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>onFail</span></span><span>(</span><span class="storage type primitive array java"><span>int</span></span><span>&nbsp;</span><span class="variable parameter java"><span>code</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mLoginView</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>showError</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section inner-class end java"><span>}</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>我们现在需要对<code>LoginPresenter</code>进行测试，我们的测试点在于接收到不同的回调结果的时候，对View进行不同的展示，至于<code>UserManager</code>的测试则应该是另外的一个测试单元的 <code>LoginPresenter</code>的测试代码</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>TestDemo</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Mock</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>LoginView</span></span><span>&nbsp;mLoginView</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Mock</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>UserManager</span></span><span>&nbsp;mUserManager</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>LoginPresenter</span></span><span>&nbsp;mLoginPresenter</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Captor</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type generic java"><span>ArgumentCaptor&lt;</span><span class="storage type java"><span>LoginCallback</span></span><span>&gt;</span></span><span>&nbsp;mCallbackArgumentCaptor</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Before</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>before</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>MockitoAnnotations</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>initMocks</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mLoginPresenter&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>LoginPresenter</span></span><span>(</span><span>mLoginView,&nbsp;mUserManager</span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>showError</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mLoginPresenter</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>login</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>username</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>password</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>verify</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mUserManager</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>times</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>1</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>performLogin</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>anyString</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>anyString</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;mCallbackArgumentCaptor</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>capture</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mCallbackArgumentCaptor</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getValue</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onFail</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>0</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>verify</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mLoginView</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>times</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>1</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>showError</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>showSuccess</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mLoginPresenter</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>login</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>username</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>password</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>verify</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mUserManager</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>times</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>1</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>performLogin</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>anyString</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>anyString</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;mCallbackArgumentCaptor</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>capture</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mCallbackArgumentCaptor</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getValue</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onSuccess</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>verify</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mLoginView</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>times</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>1</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>showSuccess</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>这里的关键是<code>@Captor ArgumentCaptor&lt;LoginCallback&gt; mCallbackArgumentCaptor;</code> ，ArgumentCaptor是作用是用来捕获所传入方法特定的参数，然后可以进一步对参数进行断言，而且是在方法调用之后使用。这里我们捕获到<code>UserManager#performLogin</code>的第三个<code>LoginCallback</code>的参数，然后直接使用它来做相应回调来验证不同情况下的反馈结果是否正确</p>
<h4 id="mockito-">Mockito的一些替代或扩增库</h4>
<p>使用Mockito并不可以Mock对象的静态方法、private修饰的方法、static方法、构造函数等，使用JMockit或PowerMock是可以解决这样的问题，有时间的话可以去实践下</p>
<h3 id="-">单元测试的优点</h3>
<ul>
<li>不依赖Android的API，运行速度快，所以更快地得到结果反馈</li>
<li>引导更好的代码设计（单一职责、依赖注入），如果一个类不好测，往往是因为这个类的设计是有问题</li>
</ul>
<h2 id="instrumented-tests">Instrumented Tests</h2>
<p>Instrumented Unit tests是需要运行再Android设备上的（物理/虚拟），通常我们使用Mock的方式不能很好解决对Android的API的依赖的这个问题，而使用这种测试方式可以依赖Android的API，使用Android提供的Instrumentation系统，将单元测试代码运行在模拟器或者是真机上，但很多情况来说，我们还是会需要和Mockito一起使用的。<strong>这中方案速度相对慢，因为每次运行一次单元测试，都需要将整个项目打包成apk，上传到模拟器或真机上，就跟运行了一次app似得</strong>，所以。</p>
<h3 id="-https-developer-android-com-topic-libraries-testing-support-library-index-html-"><a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#">配置</a></h3>
<ul>
<li>测试代码目录：(src/androidTest/java)</li>
<li><p>一般使用到的测试框架</p>
<ul>
<li><p>Testing Support Library</p>
<ul>
<li>AndroidJUnitRunner ： JUnit 4-compatible test runner for Android</li>
<li>Espresso ：UI testing framework; suitable for functional UI testing within an app</li>
<li>UI Automator ：UI testing framework; suitable for cross-app functional UI testing across system and installed apps</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="-">使用</h3>
<h4 id="androidjunitrunner">AndroidJUnitRunner</h4>
<p>AndroidJUnitRunner是JUnit4运行在Android平台上的兼容版本，使用也是很简单的且方法类似，以上面测试异步任务为例子</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta declaration annotation java"><span class="storage type annotation java"><span>@RunWith</span></span><span class="punctuation definition annotation-arguments begin java"><span>(</span></span><span class="storage type java"><span>AndroidJUnit4</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span class="punctuation definition annotation-arguments end java"><span>)</span></span></span></span></div><div class="line"><span class="source java"><span class="storage type annotation java"><span>@MediumTest</span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>TestRunningAppScanner</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta definition variable java"><span class="storage type java"><span>CountDownLatch</span></span><span>&nbsp;</span><span class="meta definition variable name java"><span>mSignal</span></span><span>&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>RunningAppScanner</span></span><span>&nbsp;mRunningAppScanner</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Mock</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>BaseScanner</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="storage type generic java"><span>ScanListener&lt;</span><span class="storage type generic java"><span>List&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>&gt;</span></span><span>&nbsp;mRunningAppBeanScanListener</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Before</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>setUp</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSignal&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>CountDownLatch</span></span><span>(</span><span class="constant numeric java"><span>1</span></span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>MockitoAnnotations</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>initMocks</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="variable language this java"><span>this</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mRunningAppScanner&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>spy</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>RunningAppScanner</span></span><span>(</span><span class="storage type java"><span>InstrumentationRegistry</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getTargetContext</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>)</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@After</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>tearDown</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSignal</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>countDown</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>testRunningApp</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="meta throwables java"><span class="storage modifier java"><span>throws</span></span><span>&nbsp;</span><span class="storage type java"><span>InterruptedException</span></span><span>&nbsp;</span></span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertFalse</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isRunning</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>doAnswer</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>Answer</span></span><span>(</span><span>)</span><span>&nbsp;</span><span class="meta inner-class java"><span class="punctuation section inner-class begin java"><span>{</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type java"><span>Object</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>answer</span></span><span>(</span><span class="storage type java"><span>InvocationOnMock</span></span><span>&nbsp;</span><span class="variable parameter java"><span>invocation</span></span><span>)</span></span><span>&nbsp;</span><span class="meta throwables java"><span class="storage modifier java"><span>throws</span></span><span>&nbsp;</span><span class="storage type java"><span>Throwable</span></span><span>&nbsp;</span></span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSignal</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>countDown</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;invocation</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getArguments</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta method-call java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section inner-class end java"><span>}</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>when</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppBeanScanListener</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onScannedCompleted</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>(</span><span class="storage type generic java"><span>List&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>)</span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>any</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>setScanListener</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppBeanScanListener</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>startScanning</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertTrue</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isRunning</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mSignal</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>await</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Assert</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>assertFalse</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppScanner</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isRunning</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>verify</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>mRunningAppBeanScanListener</span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>times</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="constant numeric java"><span>1</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onScannedCompleted</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>(</span><span class="storage type generic java"><span>List&lt;</span><span class="storage type java"><span>RunningAppBean</span></span><span>&gt;</span></span><span>)</span><span>&nbsp;</span><span class="storage type java"><span>Mockito</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>any</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;</span></span><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p>需要在测试类的定义上加上<code>@RunWith(AndroidJUnit4.class)</code>标注，另外<code>@MediumTest</code>标注是用来指定测试规模，有三种类型可以指定，限制如下，因为这里的异步任务的目的是扫描所有正在运行的App，所以这里使用<code>@MediumTest</code>，其他的<code>Assert#XXX</code>、<code>@Befor</code>，<code>@After</code>使用一致，另外这里还搭配Mockito使用。因为需要真正用到系统的一些服务（AMS，PKMS）或资源，这里的<code>InstrumentationRegistry</code>可以为我们提供<code>Instrumentation</code>对象，测试App的<code>Context</code>对象，目标App的<code>Context</code>对象和通过命令行启动测试所提供的参数信息。这里的 <code>InstrumentationRegistry.getTargetContext()</code> 就是用来获取目标App的<code>Context</code>对象。</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>SmallTest</th>
<th>MediumTest</th>
<th>LargeTest</th>
</tr>
</thead>
<tbody>
<tr>
<td>Network</td>
<td>No</td>
<td>localhost only</td>
<td>Yes</td>
</tr>
<tr>
<td>Database</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>File system access</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Use external systems</td>
<td>No</td>
<td>Discouraged</td>
<td>Yes</td>
</tr>
<tr>
<td>Multiple threads</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Sleep statements</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>System properties</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Execution Time (ms)</td>
<td>200&lt;</td>
<td>1000&lt;</td>
<td>&gt;1000</td>
</tr>
</tbody>
</table>
<h4 id="espresso">Espresso</h4>
<p>Espresso提供大量的方法用来进行UI测试，这些API可以让你写的简洁和可靠的自动化UI测试，站在用户的角度测试，所有逻辑是黑盒</p>
<p>Espresso的三个重要功能：</p>
<ul>
<li>灵活的可扩展的视图（特别是AdapterView）匹配APIs. 详情 <a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-matching">View matching</a>.</li>
<li>大量的UI交互操作APIs. 详情 <a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-actions">Action APIs</a>.</li>
<li>UI线程同步，提高测试可靠性, 详情 <a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#espresso-thread-sync">UI thread synchronization</a>.</li>
</ul>
<p>使用流程</p>
<ul>
<li>元素定位</li>
</ul>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage type java"><span>ViewInteraction</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>onView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type generic java"><span>Matcher&lt;</span><span class="storage type java"><span>View</span></span><span>&gt;</span></span><span>&nbsp;viewMatcher</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span><span class="punctuation section block end java"><span>}</span></span></span></div></pre>
<p><code>Espresso.onView</code>方法接收一个<code>Matcher&lt;View&gt;</code>类型的入参，并返回一个<code>ViewInteraction</code>对象。<code>ViewMatchers</code>对象提供了大量的<code>withXXX</code>方法用来定位元素，常用的有<code>withId</code>，<code>withText</code>和一系列的<code>isXXX</code>方法用来判断元素的状态。如果单一的匹配条件无法精确地匹配出来唯一的控件，我们可能还需要额外的匹配条件，此时可以用<code>AllOf#allOf()</code>方法来进行复合匹配条件的构造(下面的AdapterView节有使用到)：</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta method-call java"><span class="meta method java"><span>onView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>allOf</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>withId</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>id</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>withText</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>text</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></div></pre>
<ul>
<li>操作元素</li>
</ul>
<p>当定位到元素后，返回一个<code>ViewInteraction</code>对象，其<code>perform</code>方法可以接收一系列<code>ViewAction</code>用来进行模拟用户操作，<code>ViewActions</code>类提供了大量的操作实现，常用的有<code>typeText</code>，<code>click</code>等</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>ViewInteraction</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>perform</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>ViewAction</span></span><span class="keyword operator dereference java"><span>.</span><span>.</span></span><span>.&nbsp;viewActions</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span><span class="punctuation section block end java"><span>}</span></span></span></div></pre>
<ul>
<li>验证结果</li>
</ul>
<p>最后为了验证操作是否符合预期，我们还是需要定位到元素，获得一个<code>ViewInteraction</code>对象，其<code>check</code>方法接收了一个<code>ViewAssertion</code>的入参，该入参的作用就是检查结果是否符合我们的预期。</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>ViewInteraction</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>check</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>ViewAssertion</span></span><span>&nbsp;viewAssert</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span><span class="punctuation section block end java"><span>}</span></span></span></div></pre>
<p><code>ViewAssertion</code>提供如下方法,这个方法接收了一个匹配规则，然后根据这个规则为我们生成了一个<code>ViewAssertion</code>对象,这个<code>Matcher&lt;View&gt;</code>的如参和定位元素的时候是一个用法的</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage type java"><span>ViewAssertion</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>matches</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type generic java"><span>Matcher&lt;</span><span>?&nbsp;super&nbsp;</span><span class="storage type java"><span>View</span></span><span>&gt;</span></span><span>&nbsp;viewMatcher</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span><span class="punctuation section block end java"><span>}</span></span></span></div></pre>
<p>下面是测试主页部分UI测试的代码</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="meta declaration annotation java"><span class="storage type annotation java"><span>@RunWith</span></span><span class="punctuation definition annotation-arguments begin java"><span>(</span></span><span class="storage type java"><span>AndroidJUnit4</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span class="punctuation definition annotation-arguments end java"><span>)</span></span></span></span></div><div class="line"><span class="source java"><span class="storage type annotation java"><span>@LargeTest</span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>MainActivityUITest</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;ActivityTestRule}&nbsp;is&nbsp;a&nbsp;JUnit&nbsp;{@link&nbsp;Rule&nbsp;@Rule}&nbsp;to&nbsp;launch&nbsp;your&nbsp;activity&nbsp;under&nbsp;test.</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&lt;p/&gt;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Rules&nbsp;are&nbsp;interceptors&nbsp;which&nbsp;are&nbsp;executed&nbsp;for&nbsp;each&nbsp;test&nbsp;method&nbsp;and&nbsp;are&nbsp;important&nbsp;building</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;blocks&nbsp;of&nbsp;Junit&nbsp;tests.</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Rule</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta definition variable java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type generic java"><span>ActivityTestRule&lt;</span><span class="storage type java"><span>MainActivity</span></span><span>&gt;</span></span><span>&nbsp;</span><span class="meta definition variable name java"><span>mActivityRule</span></span><span>&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type generic java"><span>ActivityTestRule&lt;</span><span class="storage type java"><span>MainActivity</span></span><span>&gt;</span></span><span>(</span><span class="storage type java"><span>MainActivity</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class,&nbsp;</span><span class="constant language java"><span>true</span></span><span>,&nbsp;</span><span class="constant language java"><span>false</span></span><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>默认在测试之前启动该Activity</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;ActivityTestRule&lt;MainActivity&gt;&nbsp;mActivityRule&nbsp;=&nbsp;new&nbsp;ActivityTestRule&lt;MainActivity&gt;(MainActivity.class);</span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>testNavigateToAdvanceFragment</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Intent</span></span><span>&nbsp;intent&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>Intent</span></span><span>(</span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>携带信息的方式启动Activity</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intent</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>putExtra</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>EXTRA</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>Test</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mActivityRule</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>launchActivity</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>intent</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>&nbsp;Open&nbsp;Drawer&nbsp;to&nbsp;click&nbsp;on&nbsp;navigation.</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Espresso</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewMatchers</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>withId</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>R</span></span><span class="keyword operator dereference java"><span>.</span></span><span>id</span><span class="keyword operator dereference java"><span>.</span></span><span>drawer_layout</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</span><span class="meta method-call java"><span class="meta method java"><span>check</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewAssertions</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>matches</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>DrawerMatchers</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isClosed</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>Gravity</span></span><span class="constant other java"><span class="keyword operator dereference java"><span>.</span></span><span>LEFT</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</span><span class="meta method-call java"><span class="meta method java"><span>perform</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>DrawerActions</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>open</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span><span>&nbsp;</span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>&nbsp;Open&nbsp;Drawer</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>&nbsp;navigate&nbsp;to&nbsp;advance&nbsp;fragment.</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Espresso</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewMatchers</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>withText</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>R</span></span><span class="keyword operator dereference java"><span>.</span></span><span>string</span><span class="keyword operator dereference java"><span>.</span></span><span>advanced_settings_group_title_advanced_features</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</span><span class="meta method-call java"><span class="meta method java"><span>perform</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewActions</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>click</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>&nbsp;Left&nbsp;Drawer&nbsp;should&nbsp;be&nbsp;closed.</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Espresso</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewMatchers</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>withId</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>R</span></span><span class="keyword operator dereference java"><span>.</span></span><span>id</span><span class="keyword operator dereference java"><span>.</span></span><span>drawer_layout</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</span><span class="meta method-call java"><span class="meta method java"><span>check</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewAssertions</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>matches</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>DrawerMatchers</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isClosed</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>Gravity</span></span><span class="constant other java"><span class="keyword operator dereference java"><span>.</span></span><span>LEFT</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Espresso</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewMatchers</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>withText</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>R</span></span><span class="keyword operator dereference java"><span>.</span></span><span>string</span><span class="keyword operator dereference java"><span>.</span></span><span>fingerprint_settings_title</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>check</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewAssertions</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>matches</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>ViewMatchers</span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>isDisplayed</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<p><code>@Rule</code>+<code>ActivityTestRule</code>用来标记需要测试的Activity，测试框架会再运行@Test标注的测试用例之前会启动这个指定的Activity（类似还有<code>IntentsTestRule</code>，<code>ServiceTestRule</code>分别用于测试Intent和Service），有些情况我们测试的<code>Actvity</code>需要再<code>Intent</code>那里携带一些信息，这里也是可以通过<code>ActivityTestRule</code>的不同构造函数+<code>ActivityTestRule#launchActivity</code>方法来完成</p>
<p>它的作用是找到<code>R.id.drawer_layout</code>的View，这是一个<code>DrawerLayout</code>，<code>DrawerMatchers</code>提供了用于判断<code>DrawerLayout</code>的状态，<code>DrawerActions</code>类提供了用于操作<code>DrawerLayout</code>的操作。首先是判断<code>DrawerLayout</code>是隐藏的，然后打开抽屉，并找到<code>R.string.advanced_settings_group_title_advanced_features</code>标记的Item，进行一次点击操作，最后验证当前显示的是高级界面</p>
<h5 id="-adapterview">处理AdapterView</h5>
<p>不同于之前提到的静态的控件，<code>AdapterView</code>在加载数据时，可能只有一部分显示在了屏幕上，对于没有显示在屏幕上的那部分数据，我们通过<code>Espresso.onView()</code>是没有办法找到的。所以需要使用<code>Espresso.onData()</code>,为了精确定位，通常还需要我们自定义<code>Matcher</code></p>
<p>基本流程的区别在于元素定位上：</p>
<ul>
<li>元素定位</li>
</ul>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage type java"><span>DataInteraction</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>onData</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type generic java"><span>Matcher&lt;</span><span>?&nbsp;extends&nbsp;</span><span class="storage type java"><span>Object</span></span><span>&gt;</span></span><span>&nbsp;dataMatcher</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span><span class="punctuation section block end java"><span>}</span></span></span></div></pre>
<p>这个方法接收一个<code>Matcher&lt;? extends Object&gt;</code>类型的入参，并返回一个<code>DataInteraction</code>对象。<code>DataInteraction</code>关注于AdapterView的数据。由于AdapterView的数据源可能很长，很多时候无法一次性将所有数据源显示在屏幕上，因此我们主要先关注AdapterView中包含的数据，而非一次性就进行视图元素的匹配，入参<code>Matcher&lt;? extends Object&gt;</code>构造一个针对于Object(数据)匹配的匹配规则。从以上对比可以看出，我们在使用<code>onData()</code>方法对AdapterView进行测试的时候，我们的思路就转变成了首先关注这个AdapterView的具体数据，而不是UI上呈现的内容。当然，我们最终的目标还是要找到目标的UI元素，但是我们是通过其数据源来进行入手的</p>
<ul>
<li><p>自定义Matcher</p>
<p>对于针对于Object(数据)的匹配器一般都需要我们自定义的，如下是针对AdapterView的数据是<code>LockerItem</code>类型的匹配器，用于<code>LockerItem</code>对象的<code>title</code>字段是否为输入的字符串，复写的<code>matchesSafely()</code>方法是真正执行匹配的地方了：</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></div><div class="line"><span class="source java"><span class="comment block java"><span>*&nbsp;查找指定关键字的搜索条件</span></span></span></div><div class="line"><span class="source java"><span class="comment block java"><span>*&nbsp;@param&nbsp;name&nbsp;需要搜索的关键字</span></span></span></div><div class="line"><span class="source java"><span class="comment block java"><span class="punctuation definition comment java"><span>*/</span></span></span></span></div><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="storage type generic java"><span>Matcher&lt;</span><span class="storage type java"><span>Object</span></span><span>&gt;</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>lockItemMatcher</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;name</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type generic java"><span>BoundedMatcher&lt;</span><span class="storage type java"><span>Object</span></span><span>,&nbsp;</span><span class="storage type java"><span>LockerItem</span></span><span>&gt;</span></span><span>(</span><span class="storage type java"><span>LockerItem</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span>)</span><span>&nbsp;</span><span class="meta inner-class java"><span class="punctuation section inner-class begin java"><span>{</span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>protected</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>boolean</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>matchesSafely</span></span><span>(</span><span class="storage type java"><span>LockerItem</span></span><span>&nbsp;</span><span class="variable parameter java"><span>item</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;item&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span>&nbsp;</span><span class="keyword operator logical java"><span>&amp;&amp;</span></span><span>&nbsp;item</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getTitle</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>equals</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>name</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span>&nbsp;</span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>describeTo</span></span><span>(</span><span class="storage type java"><span>Description</span></span><span>&nbsp;</span><span class="variable parameter java"><span>description</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>appendText</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>SearchItem&nbsp;has&nbsp;Name:&nbsp;</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;name</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section inner-class end java"><span>}</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></div><div class="line"><span class="source java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section block end java"><span>}</span></span></span></div></pre>
</li>
<li><p>指定AdapterView</p>
<p>通常还需要我们指定AdapterView，避免存在多个AdapterView的时候所带来的麻烦,通过<code>inAdapterView</code>方法来匹配，匹配规则和之前的视图匹配一样，可以同id来进行匹配</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type java"><span>DataInteraction</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>inAdapterView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type generic java"><span>Matcher&lt;</span><span class="storage type java"><span>View</span></span><span>&gt;</span></span><span>&nbsp;adapterMatcher</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation section block begin java"><span>{</span></span><span class="punctuation section block end java"><span>}</span></span></span></div></pre>
</li>
<li><p>Child View</p>
<p>有时候我们需要对一个View中的某个子控件进行操作（比如点击一个ListView条目中的某个指定Button），这时我们可以通过`onChildView``方法指定相应的子控件</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span class="storage type java"><span>DataInteraction</span></span><span>&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>onChildView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type generic java"><span>Matcher&lt;</span><span class="storage type java"><span>View</span></span><span>&gt;</span></span><span>&nbsp;childMatcher</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span>&nbsp;</span><span class="punctuation section block begin java"><span>{</span></span><span class="punctuation section block end java"><span>}</span></span></span></div></pre>
</li>
<li><p>操作元素</p>
</li>
</ul>
<p>同处理普通元素差不多</p>
<ul>
<li>验证结果</li>
</ul>
<p>同处理普通元素差不多</p>
<p>下面是一个找到id为<code>R.id.main_list</code>和数据类型为<code>LockerItem</code>的AdapterView中标题为<code>WeChat</code>的元素，并对该元素中id为<code>R.id.item_ripple</code>的子元素模拟一次点击事件</p>
<pre class="editor-colors lang-java"><div class="line"><span class="source java"><span>&nbsp;</span></span></div><div class="line"><span class="source java"><span class="meta declaration annotation java"><span class="storage type annotation java"><span>@RunWith</span></span><span class="punctuation definition annotation-arguments begin java"><span>(</span></span><span class="storage type java"><span>AndroidJUnit4</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span class="punctuation definition annotation-arguments end java"><span>)</span></span></span></span></div><div class="line"><span class="source java"><span class="storage type annotation java"><span>@LargeTest</span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta class identifier java"><span class="storage modifier java"><span>class</span></span><span>&nbsp;</span><span class="entity name type class java"><span>MainActivityUITest</span></span></span><span>&nbsp;</span><span class="meta class body java"><span class="punctuation section class begin java"><span>{</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;{@link&nbsp;ActivityTestRule}&nbsp;is&nbsp;a&nbsp;JUnit&nbsp;{@link&nbsp;Rule&nbsp;@Rule}&nbsp;to&nbsp;launch&nbsp;your&nbsp;activity&nbsp;under&nbsp;test.</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&lt;p/&gt;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Rules&nbsp;are&nbsp;interceptors&nbsp;which&nbsp;are&nbsp;executed&nbsp;for&nbsp;each&nbsp;test&nbsp;method&nbsp;and&nbsp;are&nbsp;important&nbsp;building</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;blocks&nbsp;of&nbsp;Junit&nbsp;tests.</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Rule</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta definition variable java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage type generic java"><span>ActivityTestRule&lt;</span><span class="storage type java"><span>MainActivity</span></span><span>&gt;</span></span><span>&nbsp;</span><span class="meta definition variable name java"><span>mActivityRule</span></span><span>&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type generic java"><span>ActivityTestRule&lt;</span><span class="storage type java"><span>MainActivity</span></span><span>&gt;</span></span><span>(</span><span class="storage type java"><span>MainActivity</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class,&nbsp;</span><span class="constant language java"><span>true</span></span><span>,&nbsp;</span><span class="constant language java"><span>false</span></span><span>)</span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Test</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>testLockFirstItem</span></span><span>(</span><span>)</span></span><span>&nbsp;</span><span class="meta throwables java"><span class="storage modifier java"><span>throws</span></span><span>&nbsp;</span><span class="storage type java"><span>InterruptedException</span></span><span>&nbsp;</span></span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type java"><span>Intent</span></span><span>&nbsp;intent&nbsp;</span><span class="keyword operator assignment java"><span>=</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type java"><span>Intent</span></span><span>(</span><span>)</span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intent</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>putExtra</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>EXTRA</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span>&nbsp;</span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>Test</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mActivityRule</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>launchActivity</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>intent</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method-call java"><span class="meta method java"><span>onData</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>allOf</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>is</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>instanceOf</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>LockerItem</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition seperator parameter java"><span>,</span></span><span class="meta method-call java"><span class="meta method java"><span>lockItemMatcher</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>WeChat</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>inAdapterView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>withId</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>R</span></span><span class="keyword operator dereference java"><span>.</span></span><span>id</span><span class="keyword operator dereference java"><span>.</span></span><span>main_list</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>onChildView</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>withId</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="storage type java"><span>R</span></span><span class="keyword operator dereference java"><span>.</span></span><span>id</span><span class="keyword operator dereference java"><span>.</span></span><span>item_ripple</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>perform</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="meta method-call java"><span class="meta method java"><span>click</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="punctuation whitespace comment leading java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash java"><span class="punctuation definition comment java"><span>//</span></span><span>...</span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block java"><span class="punctuation definition comment java"><span>/*</span></span><span>*</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;查找指定关键字的搜索条件</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;name&nbsp;需要搜索的关键字</span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="comment block java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment java"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="storage modifier java"><span>static</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type generic java"><span>Matcher&lt;</span><span class="storage type java"><span>Object</span></span><span>&gt;</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>lockItemMatcher</span></span><span>(</span><span class="storage modifier java"><span>final</span></span><span>&nbsp;</span><span class="storage type java"><span>String</span></span><span>&nbsp;</span><span class="variable parameter java"><span>name</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;</span><span class="keyword control new java"><span>new</span></span><span>&nbsp;</span><span class="storage type generic java"><span>BoundedMatcher&lt;</span><span class="storage type java"><span>Object</span></span><span>,&nbsp;</span><span class="storage type java"><span>LockerItem</span></span><span>&gt;</span></span><span>(</span><span class="storage type java"><span>LockerItem</span></span><span class="keyword operator dereference java"><span>.</span></span><span>class</span><span>)</span><span>&nbsp;</span><span class="meta inner-class java"><span class="punctuation section inner-class begin java"><span>{</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>protected</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>boolean</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>matchesSafely</span></span><span>(</span><span class="storage type java"><span>LockerItem</span></span><span>&nbsp;</span><span class="variable parameter java"><span>item</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control java"><span>return</span></span><span>&nbsp;item&nbsp;</span><span class="keyword operator comparison java"><span>!=</span></span><span>&nbsp;</span><span class="constant language java"><span>null</span></span><span>&nbsp;</span><span class="keyword operator logical java"><span>&amp;&amp;</span></span><span>&nbsp;item</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>getTitle</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>equals</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span>name</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type annotation java"><span>@Override</span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta method java"><span class="storage modifier java"><span>public</span></span><span>&nbsp;</span><span class="meta method return-type java"><span class="storage type primitive array java"><span>void</span></span><span>&nbsp;</span></span><span class="meta method identifier java"><span class="entity name function java"><span>describeTo</span></span><span>(</span><span class="storage type java"><span>Description</span></span><span>&nbsp;</span><span class="variable parameter java"><span>description</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section method begin java"><span>{</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description</span><span class="keyword operator dereference java"><span>.</span></span><span class="meta method-call java"><span class="meta method java"><span>appendText</span></span><span class="punctuation definition method-parameters begin java"><span>(</span></span><span class="string quoted double java"><span class="punctuation definition string begin java"><span>&quot;</span></span><span>SearchItem&nbsp;has&nbsp;Name:&nbsp;</span><span class="punctuation definition string end java"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic java"><span>+</span></span><span>&nbsp;name</span><span class="punctuation definition method-parameters end java"><span>)</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span class="meta inner-class java"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section inner-class end java"><span>}</span></span></span><span class="punctuation terminator java"><span>;</span></span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span class="meta method java"><span class="meta method body java"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation section method end java"><span>}</span></span></span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="meta class body java"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source java"><span class="meta class java"><span class="punctuation section class end java"><span>}</span></span></span></span></div></pre>
<h2 id="mvp-">MVP各层的单元测试框架的使用</h2>
<p>Google官方的<a href="https://github.com/googlesamples/android-architecture">Android Architecture Blueprints</a>这个项目除了是Google利用不同的流行的开源库组合来搭建MVP框架的实践，同时还有完整的测试用例，所以学习价值很高，所以如果没了解过，现在就去看看吧，必定受益匪浅</p>
<p>这是这个项目对于MVP模式的各层做测试的各种测试框架使用</p>
<p><img src="/home/chensuilun/&#x6587;&#x6863;/Accumulation/android/&#x5355;&#x5143;&#x6D4B;&#x8BD5;/img/MVPTesting.png" alt="MVPTesting"></p>
<ul>
<li>View层:涉及到UI且需要再设备上运行，所以需要Espresso和AndroidJUnitRunner</li>
<li>Preseneter层：Preseneter层应该设计成纯JAVA层的，所以使用JUnit+Mockito</li>
<li>Model层：需要依赖Android环境</li>
</ul>
<h2 id="-">参考文档</h2>
<ul>
<li><a href="https://developer.android.com/training/testing/start/index.html">Best Practices for Testing</a></li>
<li><a href="https://segmentfault.com/a/1190000004930175">Android 单元测试: 首先，从是什么开始</a></li>
<li><a href="http://chriszou.com/2016/04/25/android-unit-testing-wechat-group-share.html">Android单元测试在蘑菇街支付金融部门的实践</a></li>
<li><a href="http://blog.chengdazhi.com/index.php/58">测试技巧 – 你所不知道的测试黑科技</a></li>
<li><a href="http://etutorials.org/Programming/Java+extreme+programming/Chapter+4.+JUnit/4.15+Testing+Asynchronous+Methods/">Testing Asynchronous Methods</a></li>
<li><a href="http://fernandocejas.com/2014/04/08/unit-testing-asynchronous-methods-with-mockito/">Unit testing asynchronous methods with Mockito</a></li>
<li><a href="http://www.vogella.com/tutorials/AndroidTestingEspresso/article.html#espresso_introduction">Android user interface testing with Espresso - Tutorial</a></li>
<li><a href="https://github.com/geniusmart/LoveUT">Robolectric3.0的介绍和实战</a></li>
<li><a href="http://a.codekk.com/detail/Android/%E6%89%94%E7%89%A9%E7%BA%BF/%E5%85%AC%E5%85%B1%E6%8A%80%E6%9C%AF%E7%82%B9%E4%B9%8B%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">公共技术点之依赖注入</a></li>
<li><a href="https://github.com/googlesamples/android-architecture">Android Architecture Blueprints</a></li>
<li><a href="http://www.jianshu.com/p/cf446be43ae8">解读Android官方MVP项目单元测试</a></li>
</ul></body>
</html>
